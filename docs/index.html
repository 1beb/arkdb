<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Archive and Unarchive Databases Using Flat Files • arkdb</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Archive and Unarchive Databases Using Flat Files">
<meta property="og:description" content="Flat text files provide a more robust, compressible,
  and portable way to store tables.  This package provides convenient
  functions for exporting tables from relational database connections
  into compressed text files and streaming those text files back into
  a database without requiring the whole table to fit in working memory.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">arkdb</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/arkdb.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cboettig/arkdb">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    

<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="arkdb" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#arkdb" class="anchor"></a>arkdb</h1></div>
<p>The goal of arkdb is to provide a convienent way to move data from large compressed text files (tsv, csv, etc) into any DBI-compliant database connection (e.g. MYSQL, Postgres, SQLite; see <a href="https://db.rstudio.com/dbi/">DBI</a>), and move tables out of such databases into text files. The key feature of arkdb is that files are moved between databases and text files in chunks of a fixed size, allowing the package functions to work with tables that would be much to large to read into memory all at once.</p>
<div id="links" class="section level2">
<h2 class="hasAnchor">
<a href="#links" class="anchor"></a>Links</h2>
<ul>
<li>A more detailed introduction to package design and use can be found in the package <a href="https://cboettig.github.io/arkdb/articles/arkdb_intro.html">Vignette</a>
</li>
<li><a href="https://cboettig.github.io/arkdb">Online versions of package documentation</a></li>
</ul>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install arkdb from GitHub with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"cboettig/arkdb"</span>)</a></code></pre></div>
</div>
</div>
<div id="basic-use" class="section level1">
<h1 class="hasAnchor">
<a href="#basic-use" class="anchor"></a>Basic use</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(arkdb)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># additional libraries just for this demo</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">library</span>(dbplyr)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw">library</span>(fs)</a></code></pre></div>
<div id="creating-an-archive-of-a-database" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-an-archive-of-a-database" class="anchor"></a>Creating an archive of a database</h2>
<p>Consider the <code>nycflights</code> database in SQLite:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">db &lt;-<span class="st"> </span>dbplyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dbplyr/topics/nycflights13">nycflights13_sqlite</a></span>(<span class="st">"."</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; Caching nycflights db at ./nycflights13.sqlite</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; Creating table: airlines</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; Creating table: airports</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; Creating table: flights</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; Creating table: planes</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; Creating table: weather</span></a></code></pre></div>
<p>Create an archive of the database:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="reference/ark.html">ark</a></span>(db, <span class="st">"."</span>, <span class="dt">lines =</span> <span class="dv">50000</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; Exporting in 50000 line chunks:</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; airlines</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; ...Done! (in 0.007468939 secs)</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; Exporting in 50000 line chunks:</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; airports</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; ...Done! (in 0.03748989 secs)</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; Exporting in 50000 line chunks:</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; flights</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt; ...Done! (in 9.60644 secs)</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">#&gt; Exporting in 50000 line chunks:</span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co">#&gt; planes</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">#&gt; ...Done! (in 0.06567407 secs)</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="co">#&gt; Exporting in 50000 line chunks:</span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="co">#&gt; weather</span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"><span class="co">#&gt; Warning: Closing open result set, pending rows</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="co">#&gt; ...Done! (in 0.4685881 secs)</span></a></code></pre></div>
</div>
<div id="unarchive" class="section level2">
<h2 class="hasAnchor">
<a href="#unarchive" class="anchor"></a>Unarchive</h2>
<p>Import a list of compressed tabular files (i.e. <code>*.tsv.bz2</code>) into a local SQLite database:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">files &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/dir_ls.html">dir_ls</a></span>(<span class="dt">glob =</span> <span class="st">"*.tsv.bz2"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">new_db &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/src_dbi.html">src_sqlite</a></span>(<span class="st">"local.sqlite"</span>, <span class="dt">create=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw"><a href="reference/unark.html">unark</a></span>(files, new_db, <span class="dt">lines =</span> <span class="dv">50000</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; Importing in 50000 line chunks:</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; airlines.tsv.bz2</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; ...Done! (in 0.06375909 secs)</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt; Importing in 50000 line chunks:</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; airports.tsv.bz2</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; ...Done! (in 0.03344798 secs)</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; Importing in 50000 line chunks:</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; flights.tsv.bz2</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; ...Done! (in 7.097691 secs)</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; Importing in 50000 line chunks:</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; planes.tsv.bz2</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; ...Done! (in 0.04005313 secs)</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; Importing in 50000 line chunks:</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; weather.tsv.bz2</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt; ...Done! (in 0.5894771 secs)</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"></a>
<a class="sourceLine" id="cb5-21" data-line-number="21">new_db</a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt; src:  sqlite 3.22.0 [local.sqlite]</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt; tbls: airlines, airports, flights, planes, weather</span></a></code></pre></div>
<hr>
<p>Please note that this project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/cboettig/arkdb">https://​github.com/​cboettig/​arkdb</a>
</li>
<li>Report a bug at <br><a href="https://github.com/cboettig/arkdb/issues">https://​github.com/​cboettig/​arkdb/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Carl Boettiger <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-1642-628X" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" height="16"></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/cboettig/arkdb"><img src="https://travis-ci.org/cboettig/arkdb.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/github/cboettig/arkdb?branch=master"><img src="https://codecov.io/gh/cboettig/arkdb/branch/master/graph/badge.svg" alt="Coverage status"></a></li>
<li><a href="https://ci.appveyor.com/project/cboettig/arkdb"><img src="https://ci.appveyor.com/api/projects/status/github/cboettig/arkdb?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a></li>
<li><a href="https://cran.r-project.org/package=arkdb"><img src="http://www.r-pkg.org/badges/version/arkdb" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://github.com/ropensci/onboarding/issues/224"><img src="https://badges.ropensci.org/224_status.svg"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Carl Boettiger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
